<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WITCON</title>

  <link rel="stylesheet" href="flight.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>

  <div id="app">

    <header>
      <nav>
        <h1>✈️WITCON</h1>
        <ul class="navbar">
          <li><a href="#" @click.prevent="showLoginSection()">Home</a></li>
          <li><a href="#" @click.prevent="showSearchSection()">Flights</a></li>
          <li><a href="#" @click.prevent="showHotelsSection()">Hotels</a></li>
          <li v-if="currentUser"><a href="#" @click.prevent="showBookingsSection()">Bookings</a></li>
        </ul>

        <div v-if="currentUser" class="user-info">
          Welcome, {{ currentUser.name }}!
          <button @click="logout" class="logout-btn">(Logout)</button>
        </div>
      </nav>
    </header>

    <!-- Login -->
    <section v-if="currentSection === 'login'" class="form-section">
      <form @submit.prevent="login">
        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" v-model="email" placeholder="Enter your email" required>
        </div>
        <div class="form-group">
          <label for="password">Password:</label>
          <input type="password" v-model="password" placeholder="Enter your password" required>
        </div>
        <div class="form-group button-group">
          <button type="button" @click="showSignupSection()">Create Account</button>
        </div>

        <button type="submit"><i class="fa fa-sign-in"></i> Login</button>
      </form>
    </section>

    <!-- User registration -->
    <section v-if="currentSection === 'signup'" class="form-section">
      <form @submit.prevent="signup">
        <div class="form-group">
          <label for="name">Name:</label>
          <input type="text" v-model="name" placeholder="Enter your name" required>
        </div>
        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" v-model="email" placeholder="Enter your email" required>
        </div>
        <div class="form-group">
          <label for="password">Password:</label>
          <input type="password" v-model="password" placeholder="Min 6 characters" required minlength="6">
        </div>
       <button type="submit"><i class="fa fa-user-plus"></i> Sign Up</button>
      </form>
    </section>

    <!-- Flight search -->
    <section v-if="currentSection === 'search'" class="form-section">
      <form @submit.prevent="searchFlights">
        <div class="form-group">
          <label for="origin">Origin:</label>
          <input type="text" v-model="searchParams.origin" placeholder="Enter IATA code" list="locations" required>
        </div>
        <div class="form-group">
          <label for="destination">Destination:</label>
          <input type="text" v-model="searchParams.destination" placeholder="Enter IATA code" list="locations" required>
        </div>
        <div class="form-group">
          <label for="date">Date:</label>
          <input type="date" v-model="searchParams.date" required>
        </div>
        <div class="form-group">
          <label for="priceFilter">Price: ${{ searchParams.maxPrice }}</label>
          <input type="range" v-model="searchParams.maxPrice" min="0" max="1000">
        </div>
        <div class="form-group">
          <label for="sortBy">Sort By:</label>
          <select v-model="sortBy">
            <option value="price">Price</option>
          </select>
        </div>
      <button type="submit"><i class="fa fa-search"></i> Search Flights</button>
      </form>
    </section>

    <!-- Hotel search -->
    <section v-if="currentSection === 'hotels'" class="form-section">
      <form @submit.prevent="searchHotels">
        <div class="form-group">
          <label for="location">Location:</label>
          <input type="text" v-model="hotelParams.location" placeholder="Enter city name" required>
        </div>
        <div class="form-group">
          <label for="checkIn">Check-in:</label>
          <input type="date" v-model="hotelParams.checkIn" required>
        </div>
        <div class="form-group">
          <label for="checkOut">Check-out:</label>
          <input type="date" v-model="hotelParams.checkOut" required>
        </div>

        <div class="form-group">
          <label for="priceFilter">Max Price: ${{ hotelParams.maxPrice }}</label>
          <input type="range" v-model="hotelParams.maxPrice" min="50" max="1000" step="50">
        </div>
        <button type="submit"><i class="fa fa-search"></i> Search</button>
      </form>
    </section>

    <!-- Hotel results -->
    <section v-if="currentSection === 'hotels' && showHotelResults" class="results-section">
      <div v-if="isLoading" class="loading">Loading hotels...</div>
      <div v-else>
        <div v-if="noHotelsFound" class="no-flights">
          No hotels found for the selected criteria.
        </div>
        <div v-else-if="hotels.length > 0" class="flight-results">

          <div v-for="hotel in filteredHotels" :key="hotel.property_token" class="flight-card">
            <div class="flight-header">
              <img :src="hotel.logo" :alt="hotel.name" class="airline-logo" v-if="hotel.logo">
              <h3>{{ hotel.name }}</h3>
              <div class="flight-price">${{ hotel.rate_per_night.extracted_lowest }}/night</div>
            </div>

            <div class="flight-times">
              <div class="time-block">
                <div class="airport">{{ hotel.description }}</div>
              </div>
            </div>

            <div class="flight-details">
                <div class="detail-item">
                <i class="fas fa-star"></i>
                <span>{{ hotel.extracted_hotel_class || 'N/A' }} stars</span>
              </div>
              <div class="detail-item">
                <i class="fas fa-thumbs-up"></i>
                <span>{{ hotel.overall_rating || 'N/A' }} rating</span>
              </div>
              <div class="detail-item">
                <i class="fas fa-map-marker-alt"></i>
                <span>{{ hotel.gps_coordinates.latitude }}, {{ hotel.gps_coordinates.longitude }}</span>
              </div>
            </div>

            <div v-if="hotel.amenities" class="amenities">
              <span v-for="(amenity, index) in hotel.amenities.slice(0, 5)" :key="index">
                {{ amenity }}<span v-if="index < 4">, </span>
              </span>
            </div>
              <button @click="showHotelBooking(hotel)" class="book-button">
              <i class="fas fa-hotel"></i> Book Now
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Flight results -->
    <section v-if="currentSection === 'search' && showResults" class="results-section">
      <div v-if="isLoading" class="loading">Loading flights...</div>
      <div v-else>
        <div v-if="noFlightsFound" class="no-flights">
          No flights found for the selected criteria.
        </div>
        <div v-else-if="filteredFlights.length > 0" class="flight-results">
          <!-- Flight card template -->
          <div v-for="flight in filteredFlights" :key="flight.id" class="flight-card">
            <div class="flight-header">
              <img :src="flight.airlineLogo" :alt="flight.airline" class="airline-logo" v-if="flight.airlineLogo">
              <h3>{{ flight.airline }}</h3>
              <div class="flight-price">${{ flight.price }}</div>
            </div>

            <div class="flight-number">
              <span>Flight #{{ flight.flightNumber }}</span>
              <span>{{ flight.airplane }}</span>
            </div>

            <div class="flight-times">
              <div class="time-block">
                <div class="time">{{ formatTime(flight.departureTime) }}</div>
                <div class="airport">{{ flight.departureAirport }} ({{ searchParams.origin }})</div>
              </div>

              <div class="duration-block">
                <div class="duration">{{ flight.duration }}</div>
                <div class="line"></div>
              </div>

              <div class="time-block">
                <div class="time">{{ formatTime(flight.arrivalTime) }}</div>
                <div class="airport">{{ flight.arrivalAirport }} ({{ searchParams.destination }})</div>
              </div>
            </div>

            <div class="flight-details">
              <div class="detail-item">
                <i class="fas fa-chair"></i>
                <span>{{ flight.legroom }}</span>
              </div>
              <div class="detail-item">
                <i class="fas fa-leaf"></i>
                <span>{{ flight.carbonEmissions }}</span>
              </div>
              <div class="detail-item">
                <i class="fas fa-suitcase"></i>
                <span>{{ flight.extensions.join(', ') }}</span>
              </div>
            </div>

            <button @click="bookFlight(flight.id)" class="book-button">
              <i class="fas fa-ticket-alt"></i> Book Now </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Ticket booking form -->
    <section v-if="showPassengerForm" class="form-section">
      <h2 style="text-align: center; text-decoration: underline;">Itinerary</h2>
      <form @submit.prevent="submitPassengerForm">
        <div class="form-group">
          <label for="firstName">First Name:</label>
          <input type="text" v-model="passenger.firstName" placeholder="Enter First Name" required>
        </div>
        <div class="form-group">
          <label for="lastName">Last Name:</label>
          <input type="text" v-model="passenger.lastName" placeholder="Enter Last Name" required>
        </div>
        <div class="form-group">
          <label for="passportNumber">Passport Number:</label>
          <input type="text" v-model="passenger.passportNumber" placeholder="Enter Passport Number" required>
        </div>
        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" v-model="passenger.email" placeholder="Enter Email" required>
        </div>

        <!-- Seat layout -->
        <div class="form-group">
          <div class="seat-layout">
            <div v-for="row in availableSeats" :key="row.row" class="seat-row">
              <div v-for="seat in row.seats" :key="seat" class="seat"
                :class="{ selected: passenger.seat === seat, aisle: seat === '' }"
                @click="seat && (passenger.seat = seat)">
                {{ seat || ' ' }}
              </div>
            </div>
          </div>
        </div>

        <button type="submit"><i class="fa fa-check"></i> Confirm Booking</button>
        <button type="button" @click="showPassengerForm = false"><i class="fa fa-times"></i> Cancel</button>
      </form>
    </section>

    <!-- Customer booking form for hotels -->
    <section v-if="showHotelBookingForm" class="form-section">
      <h2 style="text-align: center; text-decoration: underline;">Hotel Booking</h2>
      <form @submit.prevent="submitHotelBooking">
        <div class="form-group">
          <label for="firstName">First Name:</label>
          <input type="text" v-model="hotelPassenger.firstName" placeholder="Enter First Name" required>
        </div>
        <div class="form-group">
          <label for="lastName">Last Name:</label>
          <input type="text" v-model="hotelPassenger.lastName" placeholder="Enter Last Name" required>
        </div>
        <div class="form-group">
          <label for="passportNumber">Passport Number:</label>
          <input type="text" v-model="hotelPassenger.passportNumber" placeholder="Enter Passport Number" required>
        </div>
        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" v-model="hotelPassenger.email" placeholder="Enter Email" required>
        </div>
        <div class="form-group">
          <label for="roomType">Room Type:</label>
          <select v-model="hotelPassenger.roomType" required>
            <option v-for="type in roomTypes" :value="type">{{ type }}</option>
          </select>
        </div>
        <button type="submit"><i class="fa fa-check"></i> Confirm Booking</button>
        <button type="button" @click="cancelHotelBooking"><i class="fa fa-times"></i> Cancel</button>
      </form>
    </section>

    <!-- Bookings tab -->
    <section v-if="currentSection === 'bookings'" class="bookings-section">
      <div v-if="currentUser && currentUser.bookings && currentUser.bookings.length > 0">
        <div v-for="(booking, index) in currentUser.bookings" :key="booking.id || index" class="booking-card">
          <div class="booking-header">
            <h3 v-if="booking.type === 'flight' && booking.item">
              {{ booking.item.airline }} #{{ booking.item.flightNumber }}
            </h3>
            <h3 v-else-if="booking.item">
              {{ booking.item.name || 'Hotel Booking' }}
            </h3>
            <div class="booking-price" v-if="booking.type === 'flight' && booking.item">
              ${{ booking.item.price }}
            </div>
            <div class="booking-price" v-else-if="booking.item && booking.item.rate_per_night">
              ${{ booking.item.rate_per_night.extracted_lowest || 'N/A' }}/night
            </div>
          </div>

          <div class="booking-details">
            <!-- Flight confirmation -->
            <div v-if="booking.type === 'flight' && booking.item">
              <div class="detail-row">
                <span class="detail-label">From:</span>
                <span>{{ booking.item.departureAirport }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">To:</span>
                <span>{{ booking.item.arrivalAirport }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Departure:</span>
                <span>{{ formatDate(booking.item.departureTime) }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Arrival:</span>
                <span>{{ formatDate(booking.item.arrivalTime) }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Duration:</span>
                <span>{{ booking.item.duration }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Seat:</span>
                <span>{{ booking.passenger?.seat || 'Not assigned' }}</span>
              </div>
            </div>

            <!-- Hotel confirmation -->
            <div v-else-if="booking.item">
              <div class="detail-row">
                <span class="detail-label">Location:</span>
                <span>{{ booking.item.gps_coordinates?.latitude || 'N/A' }}, {{ booking.item.gps_coordinates?.longitude
                  || 'N/A' }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Duration:</span>
                <span>{{ booking.checkIn || 'N/A' }} to {{ booking.checkOut || 'N/A' }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Room Type:</span>
                <span>{{ booking.passenger?.roomType || 'Standard' }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Rating:</span>
                <span>{{ booking.item.overall_rating || 'N/A' }}</span>
              </div>
            </div>

            <!-- Common booking details -->
            <div class="detail-row">
              <span class="detail-label">Passenger:</span>
              <span>{{ booking.passenger?.firstName || 'N/A' }} {{ booking.passenger?.lastName || '' }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Booking Date:</span>
              <span>{{ formatDate(booking.bookingDate) }}</span>
            </div>
          </div>
        </div>
      </div>
      <div v-else class="no-bookings">
        You haven't made any bookings yet.
      </div>
    </section>
  </div>


  <script src="flight.js"></script>
</body>

</html>